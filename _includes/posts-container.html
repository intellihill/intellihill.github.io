<div class="posts-container">
    <section class="posts-banner">
        <h2 id="banner">posts-banner</h2>
    </section>
    <section class="posts-filter">
        <div class="filter-container">
            <button class="filter-btn" data-filter="all">
                전체 <span class="count">({{ site.posts.size }})</span>
            </button>
            
            {% assign all_tags = "" | split: "" %}
            {% for post in site.posts %}
                {% for tag in post.tags %}
                    {% unless all_tags contains tag %}
                        {% assign all_tags = all_tags | push: tag %}
                    {% endunless %}
                {% endfor %}
            {% endfor %}
            
            {% assign sorted_tags = all_tags | sort %}
            {% for tag in sorted_tags %}
                {% assign tag_posts = site.posts | where_exp: "post", "post.tags contains tag" %}
                <button class="filter-btn" data-filter="{{ tag }}">
                    {{ tag }} <span class="count">({{ tag_posts.size }})</span>
                </button>
            {% endfor %}
        </div>
    </section>
    <section class="posts-content">
        {% for post in site.posts %}
            <div class="post-item hidden" data-tags="{{ post.tags | join: ',' }}">
                {% include posts-list.html post=post %}
            </div>
        {% endfor %}
    </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const postItems = document.querySelectorAll('.post-item');
    const noSelectionMsg = document.querySelector('.no-selection-message');
    
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.getAttribute('data-filter');
            const isActive = this.classList.contains('active');
            
            // 같은 버튼을 다시 클릭하면 취소
            if (isActive) {
                // 모든 버튼 비활성화
                filterBtns.forEach(b => b.classList.remove('active'));
                
                // 모든 포스트 숨기기
                postItems.forEach(item => {
                    item.classList.add('hidden');
                    item.classList.remove('show');
                });
                
                // 안내 메시지 다시 표시
                if (noSelectionMsg) {
                    noSelectionMsg.classList.remove('hidden');
                }
                
                return; // 함수 종료
            }
            
            // 다른 버튼 클릭 시 정상 동작
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // 안내 메시지 숨기기
            if (noSelectionMsg) {
                noSelectionMsg.classList.add('hidden');
            }
            
            // 포스트 필터링
            postItems.forEach((item, index) => {
                const tags = item.getAttribute('data-tags').split(',');
                
                if (filter === 'all' || tags.includes(filter)) {
                    setTimeout(() => {
                        item.classList.remove('hidden');
                        item.classList.add('show');
                    }, index * 50);
                } else {
                    item.classList.add('hidden');
                    item.classList.remove('show');
                }
            });
            
            // 부드러운 스크롤
            document.querySelector('.posts-content').scrollIntoView({
                behavior: 'smooth',
                block: 'nearest'
            });
        });
    });
});
</script>