{% if page.comments != false %}
<section class="comments-section">
  <h3 class="comments-title">Comments</h3>
  <div class="giscus-container">
    <script src="https://giscus.app/client.js"
            data-repo="{{ site.giscus.repo | default: 'intellihill/intellihill.github.io' }}"
            data-repo-id="{{ site.giscus.repo_id | default: 'R_kgDOLBVhyw' }}"
            data-category="{{ site.giscus.category | default: 'Announcements' }}"
            data-category-id="{{ site.giscus.category_id }}"
            data-mapping="pathname"
            data-strict="1"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="preferred_color_scheme"
            data-lang="ko"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
  </div>
</section>

<script>
// Sync Giscus theme with site theme
(function() {
  function updateGiscusTheme() {
    const theme = document.documentElement.getAttribute('data-theme');
    const iframe = document.querySelector('iframe.giscus-frame');

    if (iframe) {
      iframe.contentWindow.postMessage(
        {
          giscus: {
            setConfig: {
              theme: theme === 'dark' ? 'dark' : 'light'
            }
          }
        },
        'https://giscus.app'
      );
    }
  }

  // Watch for theme changes
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'data-theme') {
        updateGiscusTheme();
      }
    });
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
})();
</script>
{% endif %}
